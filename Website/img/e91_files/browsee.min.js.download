!function(e){var t={};function s(i){if(t[i])return t[i].exports;var r=t[i]={i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(i,r,function(t){return e[t]}.bind(null,r));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=9)}([function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var i={EventTypes:{NETWORK_CALL:1,EVENT:2,URL:3,IDENTIFY:4,MOUSE:5,PAGE_LOAD:6,COMPONENTS:7,CUSTOM_EVENT:8},RecordingStates:{NONE:0,ALL:1,NO_DOM:2,NO_ERROR:3},ComponentAnalyticsTypes:{VIEW:1,TIME:2,CLICK:3},Integrations:{GOOGLE_ANALYTICS:1,INTERCOM:2,SLACK:3,TAWKTO:4},BrowseeUrlParams:{RECORD:"brRecord",TEST_INSTALLATION:"brTestInstall"},s4:()=>Math.floor(65536*(1+Math.random())).toString(16).substring(1),generate12DigitString:()=>Math.random().toString().slice(2,14),generate12CharacterString:()=>i.s4()+i.s4()+i.s4(),guid:()=>i.s4()+i.s4()+"-"+i.s4()+"-"+i.s4()+"-"+i.s4()+"-"+i.s4()+i.s4()+i.s4(),objectEquals:(e,t)=>{if(null==e||null==t)return e===t;if(e.constructor!==t.constructor)return!1;if(e instanceof Function)return e===t;if(e instanceof RegExp)return e===t;if(e===t||e.valueOf()===t.valueOf())return!0;if(Array.isArray(e)&&e.length!==t.length)return!1;if(e instanceof Date)return!1;if(!(e instanceof Object))return!1;if(!(t instanceof Object))return!1;var s=Object.keys(e);return Object.keys(t).every((function(e){return-1!==s.indexOf(e)}))&&s.every((function(s){return i.objectEquals(e[s],t[s])}))},getPercentScroll:e=>{var t=document.body.scrollHeight,s=window.scrollY;void 0!==e&&(s=e);var i=window.innerHeight+s;return Math.round(100*i/t)},isDnt:()=>!!(window.doNotTrack||navigator.doNotTrack||navigator.msDoNotTrack)&&!!("1"==window.doNotTrack||"yes"==navigator.doNotTrack||"1"==navigator.doNotTrack||"1"==navigator.msDoNotTrack||"msTrackingProtectionEnabled"in window.external&&window.external.msTrackingProtectionEnabled())}},function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));const i=e=>{0}},function(e,t,s){let i={MODE:"development",API_URL:"http://localhost:3010/",WEBSOCKET_URL:"ws://localhost:3010/",CDN_URL:"http://localhost:3010/",JS_PATH:"js/"};i={MODE:"production",API_URL:"https://api.browsee.io/",WEBSOCKET_URL:"wss://session.browsee.io/",CDN_URL:"https://cdn.browsee.io/",JS_PATH:"js/"},e.exports=i},function(e,t,s){"use strict";s.d(t,"a",(function(){return i})),s.d(t,"b",(function(){return r}));const i=e=>{var t=e.url,s=e.method||"POST",i=e.dataType||"application/json",r=e.withCredentials||!0,n=e.success,o=e.data||null,a=e.headers,l=new XMLHttpRequest;for(var c in l.open(s,t,!0),l.setRequestHeader("content-type",i),a)l.setRequestHeader(c,a[c]);l.withCredentials=r,l.onreadystatechange=function(){n&&4==this.readyState&&200==this.status&&n(this.responseText)},o?l.send(o):l.send()},r=function(e,t,s){var i=document.createElement("script");if(i.src=e,i.onload=s,i.onreadystatechange=s,t)t.appendChild(i);else{var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(i,r)}}},,,,,,function(e,t,s){"use strict";s.r(t);var i=s(1),r=s(0);class n{constructor(){this.options={selectors:["id","class","tag","nthchild"],prefix_tag:!1,attribute_blacklist:[],attribute_whitelist:[],quote_attribute_when_needed:!1,id_blacklist:[],class_blacklist:[]}}isElement(e){return!(1!==(null!=e?e.nodeType:void 0))}getParents(e){var t,s;if(s=[],this.isElement(e))for(t=e;this.isElement(t);)s.push(t),t=t.parentNode;return s}getTagSelector(e){return this.sanitizeItem(e.tagName.toLowerCase())}sanitizeItem(e){return e.split("").map((function(e){return":"===e?"\\"+":".charCodeAt(0).toString(16).toUpperCase()+" ":/[ !"#$%&'()*+,.\/;<=>?@\[\\\]^`{|}~]/.test(e)?"\\"+e:escape(e).replace(/\%/g,"\\")})).join("")}sanitizeAttribute(e){return this.options.quote_attribute_when_needed?this.quoteAttribute(e):e.split("").map((function(e){return":"===e?"\\"+":".charCodeAt(0).toString(16).toUpperCase()+" ":/[ !"#$%&'()*+,.\/;<=>?@\[\\\]^`{|}~]/.test(e)?"\\"+e:escape(e).replace(/\%/g,"\\")})).join("")}quoteAttribute(e){var t,s;return s=!1,t=e.split("").map((function(e){return":"===e?(s=!0,e):"'"===e?(s=!0,"\\"+e):(s=s||escape(e===!e),e)})),s?"'"+t.join("")+"'":t.join("")}getIdSelector(e){var t,s,i,r;return i=this.options.prefix_tag?this.getTagSelector(e):"",t=e.getAttribute("id"),s=this.options.id_blacklist.concat(["",/\s/,/^\d/]),t&&null!=t&&""!==t&&this.notInList(t,s)&&(r=i+"#"+this.sanitizeItem(t),1===e.ownerDocument.querySelectorAll(r).length)?r:null}notInList(e,t){return!t.find((function(t){return"string"==typeof t?t===e:t.exec(e)}))}getClassSelectors(e){var t,s,i,r,n,o;if(o=[],null!=(t=e.getAttribute("class"))&&""!==(t=(t=t.replace(/\s+/g," ")).replace(/^\s|\s$/g,"")))for(i=0,r=(n=t.split(/\s+/)).length;i<r;i++)s=n[i],this.notInList(s,this.options.class_blacklist)&&o.push("."+this.sanitizeItem(s));return o}getAttributeSelectors(e){var t,s,i,r,n,o,a,l,c,d,h,u;for(h=[],r=0,o=(u=this.options.attribute_whitelist).length;r<o;r++)s=u[r],e.hasAttribute(s)&&h.push("["+s+"="+this.sanitizeAttribute(e.getAttribute(s))+"]");for(i=this.options.attribute_blacklist.concat(["id","class"]),n=0,a=(l=e.attributes).length;n<a;n++)c=(t=l[n]).nodeName,indexOf.call(i,c)>=0||(d=t.nodeName,indexOf.call(u,d)>=0)||h.push("["+t.nodeName+"="+this.sanitizeAttribute(t.nodeValue)+"]");return h}getNthChildSelector(e){var t,s,i,r,n,o,a;if(r=e.parentNode,n=this.options.prefix_tag?this.getTagSelector(e):"",null!=r)for(t=0,s=0,i=(a=r.childNodes).length;s<i;s++)if(o=a[s],this.isElement(o)&&(t++,o===e))return n+":nth-child("+t+")";return null}testSelector(e,t){var s,i;return s=!1,null!=t&&""!==t&&1===(i=e.ownerDocument.querySelectorAll(t)).length&&i[0]===e&&(s=!0),s}testUniqueness(e,t){var s;return 1===(s=e.parentNode.querySelectorAll(t)).length&&s[0]===e}testCombinations(e,t,s){var i,r,n,o,a,l,c,d,h,u,g,p,v;if(null==s&&(s=this.getTagSelector(e)),!this.options.prefix_tag){for(r=0,o=(u=this.getCombinations(t)).length;r<o;r++)if(i=u[r],this.testSelector(e,i))return i;for(n=0,a=(g=this.getCombinations(t)).length;n<a;n++)if(i=g[n],this.testUniqueness(e,i))return i}for(d=0,l=(p=this.getCombinations(t).map((function(e){return s+e}))).length;d<l;d++)if(i=p[d],this.testSelector(e,i))return i;for(h=0,c=(v=this.getCombinations(t).map((function(e){return s+e}))).length;h<c;h++)if(i=v[h],this.testUniqueness(e,i))return i;return null}getUniqueSelector(e){var t,s,i,r,n,o;for(o=this.getTagSelector(e),t=0,s=(i=this.options.selectors).length;t<s;t++){switch(i[t]){case"id":r=this.getIdSelector(e);break;case"tag":o&&this.testUniqueness(e,o)&&(r=o);break;case"class":null!=(n=this.getClassSelectors(e))&&0!==n.length&&(r=this.testCombinations(e,n,o));break;case"attribute":null!=(n=this.getAttributeSelectors(e))&&0!==n.length&&(r=this.testCombinations(e,n,o));break;case"nthchild":r=this.getNthChildSelector(e)}if(r)return r}return"*"}getSelector(e){var t,s,i,r,n,o,a;for(a=[],s=0,i=(r=this.getParents(e)).length;s<i;s++)if(t=r[s],null!=(o=this.getUniqueSelector(t))&&(a.unshift(o),n=a.join(" > "),this.testSelector(e,n)))return n;return null}getCombinations(e){var t,s,i,r,n,o,a;for(null==e&&(e=[]),a=[[]],t=i=0,n=e.length-1;0<=n?i<=n:i>=n;t=0<=n?++i:--i)for(s=r=0,o=a.length-1;0<=o?r<=o:r>=o;s=0<=o?++r:--r)a.push(a[s].concat(e[t]));return a.shift(),a=(a=a.sort((function(e,t){return e.length-t.length}))).map((function(e){return e.join("")}))}targetProperties(e){var t={nodeName:e.nodeName.toLowerCase()};if(e.id&&(t.domId=e.id),e.name&&(t.name=e.name),e.textContent){var s=e.textContent.replace(/^\s+/,"").replace(/\s+$/,"");s.length>200&&(s=s.substring(0,200)+"..."),t.text=s}try{t.cssSelector=this.getSelector(e)}catch(e){t.cssSelector=""}const i=["alt","src","value","type","action","onclick","href","target"],r=["password","email","phone"];if(e.attributes){for(var n=e.attributes,o=0;o<n.length;o++){var a=n[o];-1!==i.indexOf(a.name)&&(t.attributes||(t.attributes={}),t.attributes[a.name]=a.value)}t.attributes&&-1!=r.indexOf(t.attributes.type)&&delete t.attributes.value}return t}}const o=["input","textarea","select","option"],a=["input","textarea","select","option","pre","code","canvas"],l=["button","a"],c={attributes:!0,childList:!0,subtree:!0},d=1,h=2,u=3,g=4,p=(e,t)=>{const s=e.x-t.x,i=e.y-t.y;return s*s+i*i};class v{constructor(e,t){this.clickSequence=[],this.clickChanges={},this.selectorGenerator=new n,this.lastNetworkCallTime=(new Date).getTime(),this.lastMutationTime=(new Date).getTime(),this.rageClickCallback=e,this.deadClickCallback=t}triggerRageClick(e,t){Object(i.a)("This is a rage click: "+e.event.pageX+":"+e.event.pageY);var s=this.selectorGenerator.targetProperties(e.event.target);this.rageClickCallback({x:e.x,y:e.y,scrollX:e.scrollX,scrollY:e.scrollY},s,t,e.time)}triggerDeadClick(e,t){Object(i.a)("That was a dead click: "+e.event.pageX+":"+e.event.pageY),this.deadClickCallback({x:e.x,y:e.y,scrollX:e.scrollX,scrollY:e.scrollY},null,t,e.time)}setObserver(){var e=window.document.getElementsByTagName("body")[0];if(!this.observer){var t=this;this.observer=new MutationObserver((function(e){t.updateMutation(e)})),this.observer.observe(e,c)}}disconnectObserver(){this.observer&&(this.observer.disconnect(),this.observer=null)}updateClick(e,t,s){var r=document.location.pathname+document.location.hash,n=Math.floor(99999999*Math.random()+1);const o=e.event.target.tagName.toLowerCase();if(!this.shouldIgnoreForRageClick(o)){this.clickSequence.push({x:e.x,y:e.y}),this.checkSequenceProximity()&&(Object(i.a)("Rage Click"),this.triggerRageClick(e,r),this.resetClickTimers()),this.rageClickTimer&&window.clearTimeout(this.rageClickTimer);var a=this;this.rageClickTimer=window.setTimeout((function(){a.resetClickTimers()}),1500)}if(this.isActionableTarget(o))s(g);else{var l=h;this.isCTATarget(o)&&(Object(i.a)("CTA click"),l=u),this.currentClick=n,this.setObserver();var c=(new Date).getTime();a=this;window.setTimeout((function(){var t=document.location.pathname+document.location.hash;if(r==t&&a&&c>a.lastNetworkCallTime&&c>a.lastMutationTime&&l!=u)a.triggerDeadClick(e,r),s(h,{});else{var i=a.clickChanges[n];i||(i={}),r!==t&&(i.url=t),s(u,i),delete a.clickChanges[n]}a.currentClick==n&&(a.currentClick=null),a.disconnectObserver()}),1e3)}}updateNetworkCall(e){this.currentClick&&(this.clickChanges[this.currentClick]||(this.clickChanges[this.currentClick]={}),this.clickChanges[this.currentClick].calls||(this.clickChanges[this.currentClick].calls=[]),this.clickChanges[this.currentClick].calls.push(e)),this.lastNetworkCallTime=(new Date).getTime()}updateMutation(e){var t=0;e.forEach((function(e){e.addedNodes&&1==e.addedNodes.length&&"html2canvas-container"==e.addedNodes[0].className||e.removedNodes&&1==e.removedNodes.length&&"html2canvas-container"==e.removedNodes[0].className||t++})),t>0&&(this.currentClick&&(this.clickChanges[this.currentClick]||(this.clickChanges[this.currentClick]={}),this.clickChanges[this.currentClick].mutations=!0),this.lastMutationTime=(new Date).getTime())}resetClickTimers(){this.clickSequence=[]}isActionableTarget(e){return-1!=o.indexOf(e)}isCTATarget(e){return-1!=l.indexOf(e)}shouldIgnoreForRageClick(e){return-1!=a.indexOf(e)}checkSequenceProximity(){if(this.clickSequence.length<4)return!1;for(var e=JSON.parse(JSON.stringify(this.clickSequence)),t=0;t<e.length;t++){const s=0==t?e.length-1:t-1;if(p(e[s],e[t])>1e4)return!1}return!0}}const m=["text","password","file","datetime","datetime-local","date","month","time","week","number","range","email","url","search","tel","color"];class w{constructor(e,t){this.eventHandlers={},this.preventClick=!1,this.preventClickTwice=!1,this.typeLock=0,this.enterTarget=null,this.prevTimeOut=null,this.readyTimeOut=null,this.pageLoaded=!0,this.recordEvent=e,this.selectorGenerator=new n,this.checkUrl=t,this.addEventHandler("type","change",this.typeEventHandler),this.addEventHandler("clickAt","click",this.clickAtEventHandler,!0),this.addEventHandler("doubleClickAt","dblclick",this.doubleClickAtEventHandler,!0),this.addEventHandler("runScript","scroll",this.scrollEventHandler,!0),this.addEventHandler("checkPageLoaded","readystatechange",this.pageLoadEventHandler,!0),this.addEventHandler("select","focus",this.selectFocusEventHandler,!0),this.addEventHandler("blur","blur",this.blurFocusEventHandler,!0),this.addEventHandler("select","change",this.selectChangeEventHandler),this.addEventHandler("move","mousemove",this.mouseMovementHandler,!0),this.addEventHandler("blur","blur",this.windowBlurEventHandler,!0,!0),this.addEventHandler("focus","focus",this.windowFocusEventHandler,!0,!0),this.addEventHandler("resize","resize",this.windowResizeEventHandler,!0,!0)}attach(){if(!this.attached){this.attached=!0,this.eventListeners={};var e=this;for(let o in this.eventHandlers){var t=JSON.parse(o),s=t.eventName,i=t.capture,r=t.isWindow;function n(){var t=this.eventHandlers[o],n=function(s){for(var i=0;i<t.length;i++)t[i].call(e,s)};r?window.addEventListener(s,n,i):window.document.addEventListener(s,n,i),this.eventListeners[o]=n}n.call(this)}}}detach(){if(this.attached){this.attached=!1;for(let i in this.eventListeners){var e=JSON.parse(i),t=e.eventName,s=e.capture;e.isWindow?window.removeEventListener(t,this.eventListeners[i],s):window.document.removeEventListener(t,this.eventListeners[i],s)}delete this.eventListeners}}addEventHandler(e,t,s,i,r){s.handlerName=e;let n=JSON.stringify({eventName:t,capture:i,isWindow:r});this.eventHandlers[n]||(this.eventHandlers[n]=[]),this.eventHandlers[n].push(s)}typeEventHandler(e){if(e.target.tagName&&0==this.typeLock&&(this.typeLock=1)){var t=e.target.tagName.toLowerCase(),s=e.target.type,i=e.target.getBoundingClientRect(),r=window.scrollX,n=window.scrollY,o=i.left+r,a=i.top+n;if("input"==t&&m.indexOf(s)>=0)if(e.target.value.length>0){if(this.recordEvent("type",this.selectorGenerator.targetProperties(e.target),e.target.value,o,a,r,n),window._browsee.sessionRecorder&&window._browsee.sessionRecorder.mirrorClient&&window._browsee.sessionRecorder.mirrorClient.applySimulated({added:[],characterDataChanged:[],removed:[],reordered:[],reparented:[],attributeChanged:{value:[e.target]}}),null!=this.enterTarget){for(var l=e.target.parentElement,c=l.tagName.toLowerCase();"form"!=c&&"body"!=c;)c=(l=l.parentElement).tagName.toLowerCase();"form"!=c||!l.hasAttribute("id")&&!l.hasAttribute("name")||l.hasAttribute("onsubmit")?this.recordEvent("sendKeys",this.selectorGenerator.targetProperties(this.enterTarget),"${KEY_ENTER}",o,a,r,n):l.hasAttribute("id")?this.recordEvent("submit",[["id="+l.id,"id"]],"",o,a,r,n):l.hasAttribute("name")&&this.recordEvent("submit",[["name="+l.name,"name"]],"",o,a,r,n),this.enterTarget=null}}else this.recordEvent("type",this.selectorGenerator.targetProperties(e.target),e.target.value,o,a,r,n);else"textarea"==t&&(this.recordEvent("type",this.selectorGenerator.targetProperties(e.target),e.target.value,o,a,r,n),window._browsee.sessionRecorder&&window._browsee.sessionRecorder.mirrorClient&&window._browsee.sessionRecorder.mirrorClient.applySimulated({added:[],characterDataChanged:[],removed:[],reordered:[],reparented:[],attributeChanged:{value:[e.target]}}))}this.typeLock=0}clickAtEventHandler(e){if(0==e.button&&!this.preventClick&&e.isTrusted){if(!this.preventClickTwice){var t=e.target.getBoundingClientRect(),s=Math.round(100*(e.clientX-t.left)/t.width),i=Math.round(100*(e.clientY-t.top)/t.height);e.target;this.recordEvent("clickAt",this.selectorGenerator.targetProperties(e.target),s+","+i,e.pageX,e.pageY,window.scrollX,window.scrollY,e),this.preventClickTwice=!0}var r=this;setTimeout((function(){r.preventClickTwice=!1}),30)}}doubleClickAtEventHandler(e){var t=e.target.getBoundingClientRect();Math.round(100*(e.pageX-t.left)/t.width),Math.round(100*(e.pageY-t.top)/t.height)}mouseMovementHandler(e){clearTimeout(this.mouseMoveTimeOut),this.mouseMoveTimeOut=setTimeout(function(){this.recordEvent("mouseMove",null,null,e.clientX,e.clientY,window.scrollX,window.scrollY)}.bind(this),100)}scrollEventHandler(e){if(!0===this.pageLoaded){var t=this;this.currentScroll;this.scrollDetector=e.target;var s=window.scrollY;this.scrollDetector!==window.document&&(s=this.scrollDetector.scrollTop),this.currentScroll||(this.currentScroll=s),clearTimeout(this.prevTimeOut),this.prevTimeOut=setTimeout(function(){var e={start:window.innerHeight+t.currentScroll,end:window.innerHeight+s,viewHeight:window.innerHeight},r=null;this.scrollDetector!==window.document&&(r=this.selectorGenerator.targetProperties(this.scrollDetector),Object(i.a)("Scroll of: ",e.element)),this.recordEvent("scroll",e,r,null,null,window.scrollX,s),delete t.scrollDetector,delete t.currentScroll}.bind(t),100)}}pageLoadEventHandler(e){var t=this;"interactive"!==window.document.readyState&&"loaded"!==window.document.readyState||this.checkUrl(),"loading"===window.document.readyState?this.pageLoaded=!1:"interactive"===window.document.readyState||(this.pageLoaded=!1,clearTimeout(this.readyTimeOut),this.readyTimeOut=setTimeout(function(){t.pageLoaded=!0}.bind(t),500))}selectFocusEventHandler(e){if(e.target.nodeName){var t=e.target.nodeName.toLowerCase();if("select"==t&&e.target.multiple)for(var s=e.target.options,i=0;i<s.length;i++)null==s[i]._wasSelected&&(s[i]._wasSelected=s[i].selected);-1!==["input","select"].indexOf(t)?(this.inputFocusTarget=e.target,this.inputFocusTime=(new Date).getTime()):this.inputFocusTarget=null}}blurFocusEventHandler(e){if(e.target.nodeName&&this.inputFocusTarget&&this.inputFocusTarget==e.target){var t=(new Date).getTime()-this.inputFocusTime;this.recordEvent("input",this.selectorGenerator.targetProperties(e.target),t,e.pageX,e.pageY,window.scrollX,window.scrollY)}}windowBlurEventHandler(e){e.target.nodeName||this.recordEvent("blur")}windowFocusEventHandler(e){e.target.nodeName||this.recordEvent("focus")}windowResizeEventHandler(){var e=this;clearTimeout(this.prevResizeTimeOut),this.prevResizeTimeOut=setTimeout((function(){e.recordEvent("resize",{width:window.innerWidth,height:window.innerHeight})}),100)}getOptionLocator(e){var t=e.text.replace(/^ *(.*?) *$/,"$1");return t.match(/\xA0/)?"label=regexp:"+t.replace(/[\(\)\[\]\\\^\$\*\+\?\.\|\{\}]/g,(function(e){return"\\"+e})).replace(/\s+/g,(function(e){return e.match(/\xA0/)?e.length>1?"\\s+":"\\s":e})):"label="+t}selectChangeEventHandler(e){if(e.target.tagName&&"select"==e.target.tagName.toLowerCase())if(e.target.multiple){for(var t=e.target.options,s=0;s<t.length;s++)if(t[s]._wasSelected,t[s]._wasSelected!=t[s].selected){var i=this.getOptionLocator(t[s]);t[s].selected?this.recordEvent("addSelection",this.selectorGenerator.targetProperties(e.target),i,e.pageX,e.pageY,window.scrollX,window.scrollY):this.recordEvent("removeSelection",this.selectorGenerator.targetProperties(e.target),i,e.pageX,e.pageY,window.scrollX,window.scrollY),t[s]._wasSelected=t[s].selected}}else{var r=e.target.options[e.target.selectedIndex];this.recordEvent("select",this.selectorGenerator.targetProperties(e.target),this.getOptionLocator(r),e.pageX,e.pageY,window.scrollX,window.scrollY),window._browsee.sessionRecorder&&window._browsee.sessionRecorder.mirrorClient&&window._browsee.sessionRecorder.mirrorClient.applySimulated({added:[],characterDataChanged:[],removed:[],reordered:[],reparented:[],attributeChanged:{selected:[r]}})}}}s(2);class f{constructor(e,t,s){this.events=[],this.session=e,this.transport=t,this.trackHandler=s}sendEvents(){this.transport.socketSend({f:"events",events:this.events}),this.events=[]}addMouseEvent(e,t,s){this.events&&this.events.length>0&&this.events[this.events.length-1].type==e&&this.events[this.events.length-1].url==t?this.events[this.events.length-1].mouseData.push(s):this.events.push({type:e,url:t,etime:this.session.getEngagementTime(),pagetime:this.session.getPageTimeSpent(),stime:this.session.getSessionTimeSpent(),width:window.innerWidth,height:window.innerHeight,mouseData:[s]})}addEvent(e,t,s){this.events||(this.events=[]),e==r.a.EventTypes.MOUSE?this.addMouseEvent(e,t,s):this.events.push({type:e,url:t,etime:this.session.getEngagementTime(),pagetime:this.session.getPageTimeSpent(),stime:this.session.getSessionTimeSpent(),data:s}),this.nextbatch&&window.clearTimeout(this.nextbatch),this.nextbatch=window.setTimeout(this.sendEvents.bind(this),500)}}class S{generateEventId(){return Math.floor(99999999*Math.random()+1)}getStoredEvents(){var e=sessionStorage.getItem("_browsee_temp");return e?JSON.parse(e):{}}storeEvents(e){sessionStorage.setItem("_browsee_temp",JSON.stringify(e))}storeEvent(e,t){var s=this.getStoredEvents();s[e]=t,this.storeEvents(s)}deleteEvent(e){var t=this.getStoredEvents();delete t[e],this.storeEvents(t)}deleteAll(){sessionStorage.removeItem("_browsee_temp")}}const T=function(e,t,s){localStorage.setItem("_brId",btoa(JSON.stringify({_id:e,_identified:t,_p:s})))};class E{constructor(e,t){this.init(e,t)}init(e,t){if(null!=e)return this.id=e,this.identified=!0,this.params=t||{},void T(this.id,this.identified,this.params);var s=function(){var e=localStorage.getItem("_brId");try{return"{"!==e[0]?JSON.parse(atob(e)):"{"==e[0]?JSON.parse(e):null}catch(e){return null}}();s?(this.id=s._id,this.identified=s._identified,this.params=s._p):(this.id=r.a.guid(),this.identified=!1,this.params={},T(this.id,this.identified,this.params))}getId(){return this.id}getParams(){return this.params}isIdentified(){return this.identified}identify(e,t){if(e!=this.id||!r.a.objectEquals(t,this.params)){var s=this.id;return this.id=e,this.identified=!0,this.params=t,T(this.id,this.identified,this.params),s}return null}}class b{constructor(){this.reset(),this.engagementTime=0}reset(){this.start=(new Date).getTime(),this.updateEvent()}getEngagementTime(){return this.engagementTime}updateEvent(){this.start?this.engagementTime=(new Date).getTime()-this.start:this.start=(new Date).getTime(),this.eventTimer&&window.clearTimeout(this.eventTimer);var e=this;this.eventTimer=window.setTimeout((function(){e.creditEngagement()}),6e4)}creditEngagement(){this.start&&(this.engagementTime=(new Date).getTime()-this.start,this.start=null)}}const k=(e,t,s,i)=>{localStorage.setItem("_browsee",JSON.stringify({_id:e,_t:t,_r:s,_p:i}))},y=e=>{localStorage.setItem("_brt",JSON.stringify({_t:e}))},C=e=>O(e,localStorage),O=(e,t)=>{var s=t.getItem(e);return s?JSON.parse(s):null};class _{constructor(e){this.initSession(),this.setSessionUrl(e)}initSession(){var e=C("_browsee"),t=C("_brt");this.handleWindowId(),!e||!t||this.lastEvent&&(new Date).getTime()-this.lastEvent>18e5||t&&(new Date).getTime()-t._t>18e5?this.createNewSession():(this.sessionId=e._id,this.sessionTime=e._t,this.record=e._r,this.prefs={},void 0!==e._c&&(this.prefs.co=e._c),void 0!==e._e&&(this.prefs.et=e._e),void 0!==e._p&&(this.prefs=e._p),this.initReferrer()),window.addEventListener("beforeunload",this.onUnload.bind(this))}initReferrer(){var e=O("_br_ref",sessionStorage);e?(this.referrer=e.ref,this.landingPage=e.lp):this.getSessionReferrer()}getId(){return this.sessionId}getWindowId(){return this.windowId}onUnload(){sessionStorage.setItem("_brlwId",this.windowId)}handleWindowId(){var e=sessionStorage.getItem("_brlwId");e?sessionStorage.removeItem("_brlwId"):e=r.a.s4(),this.windowId=e}getSessionState(){return this.hasSessionState()?{rec:this.record,prefs:this.prefs}:null}hasSessionState(){return void 0!==this.record&&null!==this.record||void 0!==this.prefs&&Object.keys(this.prefs).length}setSessionState(e){this.record=e.rec,e.prefs?this.prefs=e.prefs:(this.prefs.et=e.et,this.prefs.co=e.co),k(this.sessionId,this.sessionTime,this.record,this.prefs)}setRecordingState(e){this.record=e,k(this.sessionId,this.sessionTime,this.record,this.prefs)}getRecordingState(){return this.record}getSessionStartTime(){return this.sessionTime}getSessionTimeSpent(){return(new Date).getTime()-this.sessionTime}getPageLoadedTime(){return this.pageLoadedTime}getPageTimeSpent(){return(new Date).getTime()-this.pageLoadedTime.getTime()}getSessionUrl(){return this.sessionUrl}getEngagementTime(){return this.engagementTimer.getEngagementTime()}getReferrer(){return this.referrer}getLandingPage(){return this.landingPage}createNewSession(){this.prefs={},this.record=null,this.sessionId=r.a.generate12CharacterString(),this.sessionTime=(new Date).getTime(),k(this.sessionId,this.sessionTime),this.initReferrer()}getSessionReferrer(){var e,t;this.referrer=window.document.referrer,this.landingPage=window.location.href,e=this.referrer,t=this.landingPage,sessionStorage.setItem("_br_ref",JSON.stringify({ref:e,lp:t}))}updateEvent(){return this.lastEvent&&(new Date).getTime()-this.lastEvent>18e5?(this.createNewSession(),this.engagementTimer.reset(),this.lastEvent=(new Date).getTime(),y(this.lastEvent),this.engagementTimer.updateEvent(),!0):(this.lastEvent=(new Date).getTime(),y(this.lastEvent),this.engagementTimer.updateEvent(),!1)}setSessionUrl(e){return this.sessionUrl&&this.sessionUrl==e?(this.updateEvent(),!1):(this.sessionUrl=e,this.pageLoadedTime=new Date,delete this.engagementTimer,this.engagementTimer=new b,this.updateEvent(),!0)}}const L=s(2).WEBSOCKET_URL+"session";class N{constructor(e,t,s,i){this.init(),this.apiKey=e,this.session=t,this.user=s,this.messageHandler=i,this.queue=[]}init(){this.socket||(this.socket=new WebSocket(L),this.socket.onopen=this.onOpen.bind(this),this.socket.onclose=this.onClose.bind(this),this.socket.onmessage=this.onMessage.bind(this))}reset(){this.socket=new WebSocket(L),this.socket.onopen=this.onOpen.bind(this),this.socket.onclose=this.onClose.bind(this),this.socket.onmessage=this.onMessage.bind(this)}socketSend(e){if(this.socket||this.init(),this.socket&&this.socket.readyState!==this.socket.OPEN)this.queue.push(e);else{var t={apiKey:this.apiKey,sessionId:this.session.getId(),wId:this.session.getWindowId(),record:this.session.getRecordingState(),url:this.session.getSessionUrl(),time:this.session.getSessionTimeSpent()};e.session=t,this.socket.send(JSON.stringify(e))}}onOpen(){var e={f:"start",width:window.innerWidth,height:window.innerHeight,scrollX:window.scrollX,scrollY:window.scrollY,referrer:this.session.getReferrer(),landingPage:this.session.getLandingPage(),user:this.user.getId(),identified:this.user.isIdentified(),userParams:this.user.getParams()};if(this.socketSend(e),this.queue.length>0){for(var t=0;t<this.queue.length;t++)this.socketSend(this.queue[t]);this.queue=[]}}onMessage(e){try{var t=JSON.parse(e.data);this.messageHandler&&this.messageHandler(t)}catch(t){console.log("Invalid JSON: ",e.data)}}onClose(){this.socket=void 0}}var I=s(3),R=window._browsee||[];const A=()=>{var e=window.XMLHttpRequest.prototype.open;window.XMLHttpRequest.prototype.open=function(){this._brrequestId=Math.floor(99999999*Math.random()+1);const t=[].slice.call(arguments);return this._method=t[0],this._url=t[1],e.apply(this,t)};var t=window.XMLHttpRequest.prototype.send;window.XMLHttpRequest.prototype.send=function(){var e=this.onreadystatechange,s=function(){e&&e.apply(this,[].slice.call(arguments)),4==this.readyState&&R.trackResponse(this._brrequestId,this.status,this._url)};e?this.onreadystatechange=s:this.addEventListener("readystatechange",s);var i=t.apply(this,[].slice.call(arguments));return R.trackSend(this._brrequestId,this._method,this._url),i}},P=s(2);var U=window._browsee||function(){(U.q=U.q||[]).push(arguments)};U.pUrl=function(){return document.location.pathname+document.location.hash},U.checkUrl=function(){if(U.session&&U.recorder&&U.session.setSessionUrl(document.location.href)){U.recorder.addEvent(r.a.EventTypes.URL,U.pUrl(),{scroll:window.innerHeight+window.scrollY,scrollY:window.scrollY});var e=new Event("br_page_change");window.dispatchEvent(e)}},U.checkUrlAndAddEvent=function(e,t,s){U.checkUrl(),U.recorder&&U.recorder.addEvent(e,t,s),U.checkUrlEvent&&clearTimeout(U.checkUrlEvent),U.checkUrlEvent=setTimeout(U.checkUrl,200)},U.trackSend=function(e,t,s){const i=(new Date).getTime();U.requests||(U.requests={}),s.split&&-1==s.indexOf(P.API_URL)&&!U.requests[e]&&window.document.hasFocus()&&(U.requests[e]={start:i,method:t,url:s.split("?")[0]},U.checkUrlAndAddEvent(r.a.EventTypes.NETWORK_CALL,U.pUrl(),U.requests[e]),U.clickTracker&&U.clickTracker.updateNetworkCall(U.requests[e]))},U.trackResponse=function(e,t,s){const i=(new Date).getTime();var r;U.requests&&U.requests[e]&&window.document.hasFocus()&&((r=Object.assign?Object.assign({},U.requests[e]):JSON.parse(JSON.stringify(U.requests[e]))).statusCode=t,r.time=i-r.start,r.stime=U.session.getSessionTimeSpent(),delete r.start,U.checkUrlAndAddEvent(1,U.pUrl(),r),delete U.requests[e])},U.recordEvent=function(e,t,s,n,o,a,l,c){U.session&&(U.session.updateEvent()&&U.getSessionState());const d=U.session.getPageTimeSpent(),h=U.session.getSessionTimeSpent(),u=U.pUrl();if(U.recorder&&"mouseMove"==e)U.recorder.addEvent(r.a.EventTypes.MOUSE,u,{x:n,y:o,scrollX:a,scrollY:l,time:d,stime:h});else{Object(i.a)("Recording: "+e+" at: "+d);var p={url:u,type:e,properties:t,time:d,stime:h,wId:U.session.getWindowId(),target:s,x:n,y:o,scrollX:a,scrollY:l};if("clickAt"==e||"doubleClickAt"==e){var v=null;U.eventStore&&(v=U.eventStore.generateEventId(),U.eventStore.storeEvent(v,JSON.stringify(p))),U.clickTracker.updateClick({event:c,x:n,y:o,scrollX:a,scrollY:l,time:h},"doubleClickAt"==e,(function(e,t){U.eventStore&&U.eventStore.deleteEvent(v),e==g&&Object(i.a)("Dead or input click");var s=p,n=s.url;delete s.url,delete s.wId,s.changes=t,s.position=s.target,delete s.target,U.checkUrlAndAddEvent(r.a.EventTypes.EVENT,n,s)}))}else{var m=p;delete m.url,delete m.wId,"input"==e&&(m.inputtime=m.target,delete m.target),U.checkUrlAndAddEvent(r.a.EventTypes.EVENT,u,m)}}},U.sendStoredEvents=function(){if(U.eventStore){var e=U.eventStore.getStoredEvents();for(var t in e)if(e.hasOwnProperty(t)){var s=JSON.parse(e[t]),i=s.url;s.wId==U.session.getWindowId()&&(s.position=s.target,delete s.target,delete s.url,delete s.wId,n=s,U.checkUrlAndAddEvent(r.a.EventTypes.EVENT,i,n))}U.eventStore.deleteAll()}var n},U.sendRageClick=function(e,t,s,i){U.sendClickData(d,e,t,s,i,window.innerWidth,window.innerHeight)},U.sendDeadClick=function(e,t,s,i){},U.sendClickData=function(e,t,s,i,n,o,a){if(U.session.getRecordingState()===r.a.RecordingStates.ALL){var l={apiKey:U.apiKey,sessionId:U.session.getId(),wId:U.session.getWindowId(),url:i,time:n,type:e,coords:t,element:s,width:o,height:a};Object(I.a)({url:P.API_URL+"api/clickdata",method:"POST",data:JSON.stringify(l)})}},U.handleSocketResponse=function(e){e.record&&(U.session.setRecordingState(e.record),e.record==r.a.RecordingStates.ALL&&U.load("replay.min.js","Recorder Loaded"))},U.handleTrackResponse=function(e){var t=JSON.parse(e);t.elements&&t.elements.length},U.findOffset=function(e,t){var s=e.getBoundingClientRect(),i={x:0,y:0};return t.x&&t.y&&(i.x=t.x-s.x,i.y=t.y-s.y),i},U.sendPageLoad=function(){if(U.pageLoad&&U.recorder){var e=U.pageLoad;return void U.recorder.addEvent(r.a.EventTypes.PAGE_LOAD,e.url,{scroll:e.scroll,loadTime:e.loadTime})}const t=U.pUrl(),s=window.innerHeight+window.scrollY,i=U.session.getPageTimeSpent();U.recorder?U.recorder.addEvent(r.a.EventTypes.PAGE_LOAD,t,{scroll:s,loadTime:i}):U.pageLoad={url:t,scroll:s,loadTime:i}},U.onPageLoad=function(){"complete"===document.readyState?U.sendPageLoad():document.addEventListener("readystatechange",(function(e){"complete"===e.target.readyState&&U.sendPageLoad()}))},U.getSessionState=function(){U.user=U.user||new E,Object(I.a)({url:P.API_URL+"sessionstate?_a="+U.apiKey+"&_u="+U.user.getId()+"&_d="+(r.a.isDnt()?"1":"0")+"&_l="+encodeURIComponent(U.pUrl()),method:"GET",dataType:"text/plain",withCredentials:!1,success:function(e){if(e){var t=JSON.parse(e);U.session.setSessionState(t),U.setSession(U.session.getSessionState())}}})},U.setTestParams=function(){document.location.search&&URLSearchParams&&(new URLSearchParams(document.location.search).has(r.a.BrowseeUrlParams.RECORD)&&U.session&&U.session.setRecordingState(r.a.RecordingStates.ALL))},U.onLoad=function(){this.url=document.location.href,U.session=new _(this.url),U.setTestParams(),U.onPageLoad();var e=U.session.getSessionState();e?U.setSession(e):U.getSessionState()},U.load=function(e,t){Object(I.b)(P.CDN_URL+P.JS_PATH+e,document.body,(function(){Object(i.a)(t)}))},U.setSession=function(e){if(void 0!==e.rec&&null!==e.rec){var t=e.rec;Object(i.a)("Setting record state: "+e.rec),t!==r.a.RecordingStates.NONE&&(U.user=U.user||new E,U.transport=new N(U.apiKey,U.session,U.user,U.handleSocketResponse),U.eventTracker=new w(U.recordEvent,U.checkUrl),U.eventTracker.attach(),delete U.clickTracker,U.clickTracker=new v(U.sendRageClick,U.sendDeadClick),U.recorder=new f(U.session,U.transport,U.handleTrackResponse),U.eventStore=new S,U.sendStoredEvents(),U.pageLoad&&U.sendPageLoad(),U.recorder.addEvent(r.a.EventTypes.URL,U.pUrl(),{scroll:window.innerHeight+window.scrollY,scrollY:window.scrollY}),(e=>{if(e&&e.prefs&&e.prefs.it&&e.prefs.it.length){var t=e.prefs.it,s=window._browsee.getRecordingUrl();if(s){if(-1!==t.indexOf(r.a.Integrations.INTERCOM)&&window.Intercom&&(Object(i.a)("Intercom:"+s),window.Intercom("trackEvent","Browsee Recording",{session:{url:s,value:"View Session in Browsee"}})),-1!==t.indexOf(r.a.Integrations.GOOGLE_ANALYTICS)&&window.ga&&window.ga.getAll){const e=window.ga.getAll()[0];e&&e.send("event","Browsee Recording",s,"")}-1!==t.indexOf(r.a.Integrations.TAWKTO)&&window.Tawk_API&&(Tawk_API.addTags?Tawk_API.addTags([s],(function(){})):Tawk_API.onLoad=function(){Tawk_API.addTags([s],(function(){}))})}}})(e),A(),(s=window.fetch)&&(window.fetch=function(){var e=[].slice.call(arguments);const t=e[1]?e[1].method:"GET",i=e[0];return new Promise((function(r,n){var o=Math.floor(99999999*Math.random()+1);s.apply(window,e).then((function(e){r(e),R.trackResponse(o,e.status)})).catch((function(e){n(e),R.trackResponse(o,e.status)})),R.trackSend(o,t,i)}))}),t!==r.a.RecordingStates.NO_DOM&&(U.resetSessionRecorder?U.resetSessionRecorder():U.load("replay.min.js","Recorder Loaded")),(e.prefs.et||null==e.prefs.et)&&(U.setErrorTracker?U.setErrorTracker():U.load("raven.min.js","Raven Loaded")))}var s;e.prefs.co&&U.load("components.min.js","Components Loaded"),U.replaceQueue()},U.init=function(e){U.apiKey=e,U.initialized=!0},U.logEvent=function(e,t){if(!(null==e||"string"!=typeof e||e.length>250))return U.recorder&&U.recorder.addEvent(r.a.EventTypes.CUSTOM_EVENT,U.pUrl(),{text:e,params:t}),!0;console.log("Event names must be valid text")},U.identify=function(e,t){if(null!=e&&"string"==typeof e){if(U.user){var s=U.user.identify(e,t);s&&U.recorder&&U.recorder.addEvent(r.a.EventTypes.IDENTIFY,U.pUrl(),{id:e,params:t,anonymousId:s})}else U.user=new E(e,t);return!0}console.log("Invalid ID provided to identify call")},U.getRecordingUrl=function(e){var t="";U.session&&(U.session.getRecordingState()==r.a.RecordingStates.ALL&&(t="https://browsee.io/app/session/"+U.session.getId()));return e&&e(t),t},U.getSessionUrl=function(e){var t="https://browsee.io/app/session/";return U.session&&(t+=U.session.getId()),e&&e(t),t},U.applyMethod=function(e){var t=[].slice.call(e),s=t.shift();U[s]&&U[s].apply(null,t)},U.processQueue=function(){for(var e=0;e<U.q.length;e++)U.applyMethod(U.q.shift())},U.replaceQueue=function(){U.q.length&&U.processQueue(),U.q.push=function(e){U.applyMethod(e)}},Object(i.a)("Browsee loaded"),U.q&&(U.processQueue(),U.onLoad())}]);